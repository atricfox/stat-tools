# StatCal æ•°æ®è¿ç§»è¯¦ç»†å®æ–½è®¡åˆ’

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

åŸºäºæŠ€æœ¯æ¶æ„æ–‡æ¡£ï¼Œæœ¬è®¡åˆ’è¯¦ç»†æè¿°äº†å°† StatCal é¡¹ç›®ä» JSON æ–‡ä»¶æ•°æ®å­˜å‚¨è¿ç§»åˆ° SQLite3 æ•°æ®åº“çš„å®Œæ•´å®æ–½æ–¹æ¡ˆã€‚è¿ç§»æ—¨åœ¨æå‡æ€§èƒ½ã€æ•°æ®å®Œæ•´æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šåŸºç¡€ã€‚

**é¢„ä¼°æ—¶é—´ï¼š** 8-11 å¤©
**é£é™©ç­‰çº§ï¼š** ä¸­ç­‰
**å…³é”®æˆåŠŸæŒ‡æ ‡ï¼š** æ•°æ®å®Œæ•´æ€§ 100%ã€æ€§èƒ½æå‡ â‰¥ 30%ã€é›¶åœæœºæ—¶é—´

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡

### ä¸»è¦ç›®æ ‡
- **æ€§èƒ½ä¼˜åŒ–ï¼š** é€šè¿‡æ•°æ®åº“ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–æå‡æ•°æ®è®¿é—®é€Ÿåº¦
- **æ•°æ®å®Œæ•´æ€§ï¼š** å®ç°æ•°æ®åº“çº§åˆ«çš„çº¦æŸå’ŒéªŒè¯
- **å¯æ‰©å±•æ€§ï¼š** ä¸ºç”¨æˆ·æ•°æ®ã€åˆ†æåŠŸèƒ½ç­‰æœªæ¥æ‰©å±•åšå‡†å¤‡
- **ç»´æŠ¤æ€§ï¼š** ç®€åŒ–æ•°æ®å¤‡ä»½ã€æ¢å¤å’Œç®¡ç†æµç¨‹

### æŠ€æœ¯ç›®æ ‡
- è¿ç§»çº¦ 100-200 æ¡è®°å½•ï¼ŒåŒ…æ‹¬æœ¯è¯­è¡¨ã€è®¡ç®—å™¨ã€å†…å®¹é¡¹ç­‰
- å®ç°å…¨æ–‡æœç´¢åŠŸèƒ½ï¼ˆFTS5ï¼‰
- ä¿æŒç°æœ‰ API æ¥å£å…¼å®¹æ€§
- å»ºç«‹æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

---

## ğŸ“… è¯¦ç»†æ—¶é—´è¡¨

### ç¬¬ 1 å‘¨ï¼šå‡†å¤‡é˜¶æ®µ (3 å¤©)

#### ç¬¬ 1 å¤©ï¼šç¯å¢ƒå‡†å¤‡
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] å®‰è£… `better-sqlite3` å’Œç›¸å…³ä¾èµ–é¡¹
  - [ ] åˆ›å»ºå¼€å‘ç¯å¢ƒæ•°æ®åº“é…ç½®
  - [ ] è®¾ç½®æ•°æ®åº“è¿æ¥æ± 

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] åˆ›å»ºè¿ç§»è„šæœ¬ç›®å½•ç»“æ„
  - [ ] å»ºç«‹å¼€å‘æ•°æ®åº“å®ä¾‹
  - [ ] å‡†å¤‡æµ‹è¯•æ•°æ®é›†

#### ç¬¬ 2 å¤©ï¼šæ¶æ„éªŒè¯
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] éªŒè¯æ•°æ®åº“æ¶æ„è®¾è®¡
  - [ ] åˆ›å»ºè¡¨ç»“æ„ SQL è„šæœ¬
  - [ ] è®¾ç½®ç´¢å¼•å’Œ FTS5 è™šæ‹Ÿè¡¨

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] å®¡æŸ¥æ•°æ®å…³ç³»è®¾è®¡
  - [ ] ç¡®è®¤å¤–é”®çº¦æŸé…ç½®
  - [ ] æ€§èƒ½åŸºçº¿æµ‹è¯•

#### ç¬¬ 3 å¤©ï¼šè„šæœ¬å¼€å‘
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] å¼€å‘æ•°æ®åº“è¿æ¥ç®¡ç†æ¨¡å—
  - [ ] åˆ›å»ºè¿ç§»åŸºç±»å’Œå·¥å…·å‡½æ•°
  - [ ] è®¾ç½®é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] ç¼–å†™æ•°æ®éªŒè¯è„šæœ¬
  - [ ] åˆ›å»ºå›æ»šæœºåˆ¶
  - [ ] å•å…ƒæµ‹è¯•æ¡†æ¶æ­å»º

### ç¬¬ 2 å‘¨ï¼šå®æ–½é˜¶æ®µ (5 å¤©)

#### ç¬¬ 4 å¤©ï¼šè®¡ç®—å™¨è¿ç§»
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] å®ç°è®¡ç®—å™¨åˆ†ç»„è¿ç§»è„šæœ¬
  - [ ] è¿ç§»è®¡ç®—å™¨å·¥å…·æ•°æ®
  - [ ] éªŒè¯åˆ†ç»„å…³ç³»å®Œæ•´æ€§

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] æµ‹è¯•è®¡ç®—å™¨æ•°æ®è®¿é—®
  - [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
  - [ ] ä¿®å¤å‘ç°çš„é—®é¢˜

#### ç¬¬ 5 å¤©ï¼šæœ¯è¯­è¡¨è¿ç§»
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] å®ç°æœ¯è¯­è¡¨è¿ç§»è„šæœ¬
  - [ ] å¤„ç†åˆ†ç±»å’Œå…³ç³»æ•°æ®
  - [ ] è¿ç§»ç›¸å…³é“¾æ¥ä¿¡æ¯

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] éªŒè¯æœ¯è¯­å…³ç³»å®Œæ•´æ€§
  - [ ] æµ‹è¯•å…¨æ–‡æœç´¢åŠŸèƒ½
  - [ ] ä¼˜åŒ–æœç´¢æ€§èƒ½

#### ç¬¬ 6 å¤©ï¼šå†…å®¹è¿ç§»
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] å®ç°å†…å®¹ç±»å‹è¿ç§»
  - [ ] è¿ç§»æ“ä½œæŒ‡å—å’Œæ­¥éª¤
  - [ ] å¤„ç†å…ƒæ•°æ®ä¿¡æ¯

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] è¿ç§»ä¸»é¢˜æ•°æ®å’Œå…³ç³»
  - [ ] éªŒè¯å†…å®¹é“¾æ¥å®Œæ•´æ€§
  - [ ] å†…å®¹æœç´¢æµ‹è¯•

#### ç¬¬ 7 å¤©ï¼šæœåŠ¡å±‚é›†æˆ
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] æ›´æ–°æ•°æ®è®¿é—®æœåŠ¡å±‚
  - [ ] å®ç°æ•°æ®åº“æŸ¥è¯¢æœåŠ¡
  - [ ] é›†æˆç¼“å­˜æœºåˆ¶

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] æ›´æ–° API ç«¯ç‚¹
  - [ ] ä¿æŒå‘åå…¼å®¹æ€§
  - [ ] æ¥å£æ€§èƒ½æµ‹è¯•

#### ç¬¬ 8 å¤©ï¼šä¼˜åŒ–å’Œæµ‹è¯•
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–
  - [ ] æŸ¥è¯¢ä¼˜åŒ–å’Œç´¢å¼•è°ƒæ•´
  - [ ] ç¼“å­˜ç­–ç•¥å®ç°

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] å…¨é¢ç«¯åˆ°ç«¯æµ‹è¯•
  - [ ] æ€§èƒ½å¯¹æ¯”æµ‹è¯•
  - [ ] é—®é¢˜ä¿®å¤å’Œä¼˜åŒ–

### ç¬¬ 3 å‘¨ï¼šéƒ¨ç½²é˜¶æ®µ (3 å¤©)

#### ç¬¬ 9 å¤©ï¼šé¢„éƒ¨ç½²å‡†å¤‡
- **ä¸Šåˆ (9:00-12:00)**
  - [ ] åˆ›å»ºç”Ÿäº§ç¯å¢ƒè¿ç§»è„šæœ¬
  - [ ] æ•°æ®å¤‡ä»½å’ŒéªŒè¯
  - [ ] éƒ¨ç½²æµç¨‹æµ‹è¯•

- **ä¸‹åˆ (13:30-17:30)**
  - [ ] å›æ»šæ–¹æ¡ˆéªŒè¯
  - [ ] ç›‘æ§é…ç½®è®¾ç½®
  - [ ] å›¢é˜Ÿéƒ¨ç½²æ¼”ç»ƒ

#### ç¬¬ 10 å¤©ï¼šç”Ÿäº§éƒ¨ç½²
- **æ™šä¸Š 22:00-02:00 (ä½æµé‡æ—¶æ®µ)**
  - [ ] æ‰§è¡Œå®Œæ•´æ•°æ®å¤‡ä»½
  - [ ] è¿è¡Œç”Ÿäº§ç¯å¢ƒè¿ç§»è„šæœ¬
  - [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§
  - [ ] å¯åŠ¨æ–°æœåŠ¡å®ä¾‹
  - [ ] æ‰§è¡Œå¥åº·æ£€æŸ¥

#### ç¬¬ 11 å¤©ï¼šç›‘æ§å’Œä¼˜åŒ–
- **å…¨å¤©**
  - [ ] ç³»ç»Ÿæ€§èƒ½ç›‘æ§
  - [ ] é”™è¯¯æ—¥å¿—åˆ†æ
  - [ ] ç”¨æˆ·åé¦ˆæ”¶é›†
  - [ ] å¿…è¦çš„æ€§èƒ½è°ƒæ•´

---

## ğŸ› ï¸ è¯¦ç»†å®æ–½æ­¥éª¤

### 1. ç¯å¢ƒå‡†å¤‡é˜¶æ®µ

#### 1.1 ä¾èµ–é¡¹å®‰è£…
```bash
# å®‰è£…æ ¸å¿ƒä¾èµ–
npm install better-sqlite3@^9.6.0
npm install drizzle-orm@^0.30.10

# å®‰è£…å¼€å‘ä¾èµ–
npm install -D @types/sqlite@^3.1.11
```

#### 1.2 é¡¹ç›®ç»“æ„åˆ›å»º
```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ client.ts           # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ services/           # æ•°æ®æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ calculatorService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ glossaryService.ts
â”‚   â”‚   â”‚   â””â”€â”€ contentService.ts
â”‚   â”‚   â””â”€â”€ utils/              # æ•°æ®åº“å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ migration/              # è¿ç§»ç›¸å…³
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ migrate-data.ts         # ä¸»è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ backup-db.ts            # å¤‡ä»½è„šæœ¬
â”‚   â””â”€â”€ migrations/             # å…·ä½“è¿ç§»æ–‡ä»¶
â””â”€â”€ tests/
    â””â”€â”€ integration/            # é›†æˆæµ‹è¯•
```

#### 1.3 æ•°æ®åº“åˆå§‹åŒ–
```typescript
// scripts/init-db.ts
import Database from 'better-sqlite3';
import fs from 'fs';
import path from 'path';

export function initializeDatabase(dbPath: string): Database.Database {
    const db = new Database(dbPath);

    // å¯ç”¨å¤–é”®çº¦æŸ
    db.pragma('foreign_keys = ON');

    // æ€§èƒ½ä¼˜åŒ–é…ç½®
    db.pragma('journal_mode = WAL');
    db.pragma('synchronous = NORMAL');
    db.pragma('cache_size = 1000');
    db.pragma('temp_store = MEMORY');

    return db;
}
```

### 2. æ•°æ®è¿ç§»é˜¶æ®µ

#### 2.1 è®¡ç®—å™¨æ•°æ®è¿ç§»
```typescript
// scripts/migrations/002-calculators.ts
export async function migrateCalculators(db: Database.Database) {
    console.log('å¼€å§‹è¿ç§»è®¡ç®—å™¨æ•°æ®...');

    // è¯»å–åŸå§‹æ•°æ®
    const calculatorsData = JSON.parse(
        fs.readFileSync('data/calculators.json', 'utf8')
    );

    // è¿ç§»åˆ†ç»„
    for (const group of calculatorsData.groups) {
        const result = db.prepare(`
            INSERT OR REPLACE INTO calculator_groups
            (group_name, display_name, sort_order)
            VALUES (?, ?, ?)
        `).run(group.group_name, group.display_name, group.sort_order);

        console.log(`è¿ç§»åˆ†ç»„: ${group.group_name} (ID: ${result.lastInsertRowid})`);
    }

    // è¿ç§»è®¡ç®—å™¨
    for (const group of calculatorsData.groups) {
        const groupId = db.prepare(`
            SELECT id FROM calculator_groups WHERE group_name = ?
        `).get(group.group_name);

        for (const item of group.items) {
            const result = db.prepare(`
                INSERT OR REPLACE INTO calculators
                (group_id, name, url, description, is_hot, is_new, sort_order)
                VALUES (?, ?, ?, ?, ?, ?, ?)
            `).run(
                groupId.id,
                item.name,
                item.url,
                item.description,
                item.is_hot ? 1 : 0,
                item.is_new ? 1 : 0,
                item.sort_order
            );

            console.log(`è¿ç§»è®¡ç®—å™¨: ${item.name} (ID: ${result.lastInsertRowid})`);
        }
    }

    console.log('è®¡ç®—å™¨æ•°æ®è¿ç§»å®Œæˆ');
}
```

#### 2.2 æœ¯è¯­è¡¨æ•°æ®è¿ç§»
```typescript
// scripts/migrations/003-glossary.ts
export async function migrateGlossary(db: Database.Database) {
    console.log('å¼€å§‹è¿ç§»æœ¯è¯­è¡¨æ•°æ®...');

    const glossaryData = JSON.parse(
        fs.readFileSync('data/glossary.json', 'utf8')
    );

    // åˆ›å»ºå”¯ä¸€åˆ†ç±»é›†åˆ
    const allCategories = new Set<string>();
    glossaryData.terms.forEach(term => {
        term.categories.forEach(cat => allCategories.add(cat));
    });

    // è¿ç§»åˆ†ç±»
    for (const category of allCategories) {
        const displayName = category
            .replace(/-/g, ' ')
            .replace(/\b\w/g, l => l.toUpperCase());

        db.prepare(`
            INSERT OR IGNORE INTO categories (name, display_name)
            VALUES (?, ?)
        `).run(category, displayName);
    }

    // è¿ç§»æœ¯è¯­
    for (const term of glossaryData.terms) {
        // æ’å…¥æœ¯è¯­
        const termResult = db.prepare(`
            INSERT OR REPLACE INTO glossary_terms
            (slug, title, short_description, definition, first_letter, updated_at)
            VALUES (?, ?, ?, ?, ?, ?)
        `).run(
            term.slug,
            term.title,
            term.shortDescription,
            term.definition,
            term.firstLetter,
            term.updated || new Date().toISOString()
        );

        const termId = termResult.lastInsertRowid;

        // é“¾æ¥åˆ†ç±»
        for (const category of term.categories) {
            const categoryId = db.prepare(`
                SELECT id FROM categories WHERE name = ?
            `).get(category);

            if (categoryId) {
                db.prepare(`
                    INSERT OR IGNORE INTO term_categories (term_id, category_id)
                    VALUES (?, ?)
                `).run(termId, categoryId.id);
            }
        }

        // å¤„ç†"å‚è§"å…³ç³»
        for (const relatedTerm of term.seeAlso || []) {
            const relatedId = db.prepare(`
                SELECT id FROM glossary_terms WHERE slug = ?
            `).get(relatedTerm);

            if (relatedId) {
                db.prepare(`
                    INSERT OR IGNORE INTO term_relationships
                    (from_term_id, to_term_id, relationship_type)
                    VALUES (?, ?, 'see_also')
                `).run(termId, relatedId.id);
            }
        }

        // é“¾æ¥ç›¸å…³å·¥å…·
        for (const toolUrl of term.relatedTools || []) {
            const calculator = db.prepare(`
                SELECT id FROM calculators WHERE url = ?
            `).get(toolUrl);

            if (calculator) {
                db.prepare(`
                    INSERT OR IGNORE INTO term_calculator_links (term_id, calculator_id)
                    VALUES (?, ?)
                `).run(termId, calculator.id);
            }
        }
    }

    console.log('æœ¯è¯­è¡¨æ•°æ®è¿ç§»å®Œæˆ');
}
```

#### 2.3 æœåŠ¡å±‚æ›´æ–°
```typescript
// src/lib/db/services/calculatorService.ts
export class CalculatorService {
    private db: Database.Database;

    constructor() {
        this.db = getDatabase();
    }

    async getCalculatorGroups(): Promise<CalculatorGroup[]> {
        return this.db.all(`
            SELECT g.*,
                   json_group_array(
                       json_object(
                           'id', c.id,
                           'name', c.name,
                           'url', c.url,
                           'description', c.description,
                           'is_hot', c.is_hot,
                           'is_new', c.is_new,
                           'sort_order', c.sort_order
                       )
                   ) as items
            FROM calculator_groups g
            LEFT JOIN calculators c ON g.id = c.group_id
            GROUP BY g.id
            ORDER BY g.sort_order
        `);
    }

    async getCalculatorsByCategory(category: string): Promise<Calculator[]> {
        return this.db.all(`
            SELECT c.* FROM calculators c
            JOIN calculator_groups g ON c.group_id = g.id
            WHERE g.group_name = ?
            ORDER BY c.sort_order
        `, [category]);
    }
}
```

### 3. æ€§èƒ½ä¼˜åŒ–é˜¶æ®µ

#### 3.1 ç¼“å­˜å®ç°
```typescript
// src/lib/db/cache.ts
import NodeCache from 'node-cache';

const cache = new NodeCache({
    stdTTL: 300, // 5åˆ†é’Ÿç¼“å­˜
    checkperiod: 60,
    useClones: false
});

export class CacheManager {
    static get<T>(key: string): T | undefined {
        return cache.get<T>(key);
    }

    static set<T>(key: string, value: T, ttl?: number): boolean {
        return cache.set(key, value, ttl);
    }

    static del(key: string): number {
        return cache.del(key);
    }

    static flush(): void {
        cache.flushAll();
    }
}

// åœ¨æœåŠ¡ä¸­ä½¿ç”¨ç¼“å­˜
export class CachedCalculatorService extends CalculatorService {
    async getCalculatorGroups(): Promise<CalculatorGroup[]> {
        const cacheKey = 'calculator_groups';
        const cached = CacheManager.get<CalculatorGroup[]>(cacheKey);

        if (cached) {
            return cached;
        }

        const result = await super.getCalculatorGroups();
        CacheManager.set(cacheKey, result);
        return result;
    }
}
```

#### 3.2 æœç´¢åŠŸèƒ½å®ç°
```typescript
// src/lib/db/services/searchService.ts
export class SearchService {
    async searchContent(query: string, limit: number = 20): Promise<SearchResult[]> {
        return this.db.all(`
            SELECT
                'glossary' as type,
                g.id,
                g.title,
                g.short_description as description,
                g.slug
            FROM glossary_terms g
            JOIN content_search cs ON g.id = cs.rowid
            WHERE cs.content MATCH ?

            UNION ALL

            SELECT
                'content' as type,
                c.id,
                c.title,
                c.summary as description,
                c.slug
            FROM content_items c
            JOIN content_search cs ON c.id = cs.rowid
            WHERE cs.content MATCH ?

            LIMIT ?
        `, [query, query, limit]);
    }

    async getSearchSuggestions(query: string, limit: number = 5): Promise<string[]> {
        return this.db.all(`
            SELECT DISTINCT title
            FROM (
                SELECT title FROM glossary_terms WHERE title LIKE ?
                UNION
                SELECT title FROM content_items WHERE title LIKE ?
            )
            LIMIT ?
        `, [`${query}%`, `${query}%`, limit]).map(row => row.title);
    }
}
```

---

## âš ï¸ é£é™©è¯„ä¼°å’Œç¼“è§£ç­–ç•¥

### 1. æ•°æ®å®Œæ•´æ€§é£é™©

**é£é™©æè¿°ï¼š** è¿ç§»è¿‡ç¨‹ä¸­å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–æŸå

**ç¼“è§£æªæ–½ï¼š**
- è¿ç§»å‰åˆ›å»ºå®Œæ•´æ•°æ®å¤‡ä»½
- å®æ–½æ•°æ®éªŒè¯è„šæœ¬ï¼Œç¡®ä¿è¿ç§»å‰åæ•°æ®ä¸€è‡´æ€§
- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§æ“ä½œ
- ä¿æŒåŸå§‹ JSON æ–‡ä»¶è‡³å°‘ 1 ä¸ªæœˆ

**åº”æ€¥æ–¹æ¡ˆï¼š**
```bash
# å¿«é€Ÿå›æ»šåˆ°åŸå§‹çŠ¶æ€
cp backups/pre-migration-data.zip data/
# æ¢å¤æœåŠ¡é…ç½®ä¸ºä½¿ç”¨ JSON æ–‡ä»¶
```

### 2. æ€§èƒ½ä¸‹é™é£é™©

**é£é™©æè¿°ï¼š** æ–°çš„æ•°æ®åº“è®¿é—®æ¨¡å¼å¯èƒ½å½±å“æ€§èƒ½

**ç¼“è§£æªæ–½ï¼š**
- è¿ç§»å‰å»ºç«‹æ€§èƒ½åŸºçº¿
- å®æ–½æŸ¥è¯¢ä¼˜åŒ–å’Œç´¢å¼•ç­–ç•¥
- ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®
- ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡

**ç›‘æ§æŒ‡æ ‡ï¼š**
- API å“åº”æ—¶é—´ (< 200ms)
- æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ (< 50ms)
- å†…å­˜ä½¿ç”¨é‡ (< 500MB)
- é”™è¯¯ç‡ (< 0.1%)

### 3. æœåŠ¡ä¸­æ–­é£é™©

**é£é™©æè¿°ï¼š** è¿ç§»è¿‡ç¨‹å¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨

**ç¼“è§£æªæ–½ï¼š**
- åœ¨ä½æµé‡æ—¶æ®µæ‰§è¡Œè¿ç§»ï¼ˆå‡Œæ™¨ 2-4 ç‚¹ï¼‰
- å®æ–½è“ç»¿éƒ¨ç½²ç­–ç•¥
- å‡†å¤‡å¿«é€Ÿå›æ»šæœºåˆ¶
- è®¾ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹

**éƒ¨ç½²çª—å£ï¼š**
- **æ—¶é—´ï¼š** å‡Œæ™¨ 2:00 - 4:00
- **é¢„è®¡åœæœºæ—¶é—´ï¼š** < 5 åˆ†é’Ÿ
- **å›æ»šæ—¶é—´ï¼š** < 2 åˆ†é’Ÿ

---

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯æ–¹æ¡ˆ

### 1. æ•°æ®å®Œæ•´æ€§æµ‹è¯•

#### 1.1 è®°å½•æ•°é‡éªŒè¯
```typescript
// tests/data-verification.test.ts
describe('æ•°æ®å®Œæ•´æ€§éªŒè¯', () => {
    test('è®¡ç®—å™¨è®°å½•æ•°é‡ä¸€è‡´', () => {
        const jsonCount = getJsonCalculatorCount();
        const dbCount = getDbCalculatorCount();
        expect(jsonCount).toBe(dbCount);
    });

    test('æœ¯è¯­è¡¨è®°å½•æ•°é‡ä¸€è‡´', () => {
        const jsonCount = getJsonGlossaryCount();
        const dbCount = getDbGlossaryCount();
        expect(jsonCount).toBe(dbCount);
    });
});
```

#### 1.2 å…³ç³»å®Œæ•´æ€§æµ‹è¯•
```typescript
// tests/relationship-verification.test.ts
describe('å…³ç³»å®Œæ•´æ€§éªŒè¯', () => {
    test('æ‰€æœ‰æœ¯è¯­éƒ½æœ‰æœ‰æ•ˆåˆ†ç±»', async () => {
        const invalidRelations = await db.all(`
            SELECT t.id, t.title
            FROM glossary_terms t
            LEFT JOIN term_categories tc ON t.id = tc.term_id
            WHERE tc.term_id IS NULL
        `);
        expect(invalidRelations).toHaveLength(0);
    });

    test('æ‰€æœ‰è®¡ç®—å™¨éƒ½æœ‰æœ‰æ•ˆåˆ†ç»„', async () => {
        const invalidRelations = await db.all(`
            SELECT c.id, c.name
            FROM calculators c
            LEFT JOIN calculator_groups g ON c.group_id = g.id
            WHERE c.group_id IS NULL
        `);
        expect(invalidRelations).toHaveLength(0);
    });
});
```

### 2. æ€§èƒ½æµ‹è¯•

#### 2.1 è´Ÿè½½æµ‹è¯•
```typescript
// tests/performance.test.ts
describe('æ€§èƒ½æµ‹è¯•', () => {
    test('è®¡ç®—å™¨åˆ†ç»„æŸ¥è¯¢æ€§èƒ½', async () => {
        const startTime = Date.now();
        await calculatorService.getCalculatorGroups();
        const duration = Date.now() - startTime;
        expect(duration).toBeLessThan(100); // < 100ms
    });

    test('æœç´¢æ€§èƒ½', async () => {
        const startTime = Date.now();
        await searchService.searchContent('ç»Ÿè®¡');
        const duration = Date.now() - startTime;
        expect(duration).toBeLessThan(200); // < 200ms
    });
});
```

#### 2.2 å¹¶å‘æµ‹è¯•
```typescript
// tests/concurrency.test.ts
describe('å¹¶å‘æµ‹è¯•', () => {
    test('å¹¶å‘è¯»å–æ€§èƒ½', async () => {
        const promises = Array(100).fill(0).map(() =>
            calculatorService.getCalculatorGroups()
        );

        const startTime = Date.now();
        await Promise.all(promises);
        const duration = Date.now() - startTime;

        expect(duration).toBeLessThan(1000); // 100ä¸ªå¹¶å‘è¯·æ±‚ < 1s
    });
});
```

### 3. é›†æˆæµ‹è¯•

#### 3.1 API å…¼å®¹æ€§æµ‹è¯•
```typescript
// tests/api-compatibility.test.ts
describe('API å…¼å®¹æ€§æµ‹è¯•', () => {
    test('è®¡ç®—å™¨ API è¿”å›æ ¼å¼ä¸€è‡´', async () => {
        const oldApiResponse = await getOldApiResponse('/api/calculators');
        const newApiResponse = await getNewApiResponse('/api/calculators');

        expect(newApiResponse.data).toEqual(oldApiResponse.data);
        expect(newApiResponse.status).toBe(200);
    });
});
```

---

## ğŸ“Š éƒ¨ç½²å’Œç›‘æ§è®¡åˆ’

### 1. éƒ¨ç½²æ¸…å•

#### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] å®Œæ•´æ•°æ®å¤‡ä»½å·²å®Œæˆ
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] å›æ»šè„šæœ¬å·²å‡†å¤‡
- [ ] ç›‘æ§ç³»ç»Ÿå·²é…ç½®
- [ ] å›¢é˜Ÿæˆå‘˜å·²å°±ä½
- [ ] éƒ¨ç½²çª—å£å·²ç¡®è®¤

#### éƒ¨ç½²æ­¥éª¤
1. **å¤‡ä»½æ‰§è¡Œ (22:00)**
   ```bash
   ./scripts/backup-db.ts
   ```

2. **æ•°æ®åº“è¿ç§» (22:15)**
   ```bash
   ./scripts/migrate-data.ts --production
   ```

3. **æœåŠ¡é‡å¯ (22:30)**
   ```bash
   pm2 restart statcal
   ```

4. **å¥åº·æ£€æŸ¥ (22:35)**
   ```bash
   curl -f https://statcal.com/health || exit 1
   ```

5. **æ•°æ®éªŒè¯ (22:40)**
   ```bash
   ./scripts/verify-data.ts
   ```

### 2. ç›‘æ§æŒ‡æ ‡

#### å…³é”®æŒ‡æ ‡ç›‘æ§
- **ç³»ç»ŸæŒ‡æ ‡ï¼š** CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
- **åº”ç”¨æŒ‡æ ‡ï¼š** å“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€ååé‡
- **æ•°æ®åº“æŒ‡æ ‡ï¼š** æŸ¥è¯¢æ—¶é—´ã€è¿æ¥æ•°ã€ç¼“å­˜å‘½ä¸­ç‡
- **ä¸šåŠ¡æŒ‡æ ‡ï¼š** ç”¨æˆ·æ´»è·ƒåº¦ã€åŠŸèƒ½ä½¿ç”¨ç‡

#### å‘Šè­¦é…ç½®
```yaml
# monitoring/alerts.yml
alerts:
  - name: "é«˜å“åº”æ—¶é—´"
    condition: "response_time_p95 > 500ms"
    severity: "warning"

  - name: "é«˜é”™è¯¯ç‡"
    condition: "error_rate > 1%"
    severity: "critical"

  - name: "æ•°æ®åº“è¿æ¥é—®é¢˜"
    condition: "db_connections > 80%"
    severity: "critical"

  - name: "å†…å­˜ä½¿ç”¨è¿‡é«˜"
    condition: "memory_usage > 80%"
    severity: "warning"
```

### 3. å›æ»šè®¡åˆ’

#### å¿«é€Ÿå›æ»šæµç¨‹
1. **æ£€æµ‹åˆ°é—®é¢˜ (23:00)**
2. **æ‰§è¡Œå›æ»šè„šæœ¬**
   ```bash
   ./scripts/rollback.sh
   ```
3. **é‡å¯åŸå§‹æœåŠ¡**
   ```bash
   pm2 restart statcal-legacy
   ```
4. **éªŒè¯æœåŠ¡æ¢å¤**
   ```bash
   curl -f https://statcal.com/health
   ```

#### å›æ»šè„šæœ¬ç¤ºä¾‹
```bash
#!/bin/bash
# scripts/rollback.sh

echo "å¼€å§‹å›æ»šæµç¨‹..."

# åœæ­¢æ–°æœåŠ¡
pm2 stop statcal

# æ¢å¤æ•°æ®å¤‡ä»½
cp backups/pre-migration-$(date +%Y-%m-%d).db data/statcal.db

# é‡å¯æ—§æœåŠ¡ï¼ˆåŸºäº JSONï¼‰
pm2 start statcal-legacy

# éªŒè¯æœåŠ¡
sleep 10
if curl -f https://statcal.com/health; then
    echo "å›æ»šæˆåŠŸå®Œæˆ"
else
    echo "å›æ»šå¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„"
    exit 1
fi
```

---

## ğŸ“ˆ æˆåŠŸæ ‡å‡†å’Œåç»­è®¡åˆ’

### 1. æˆåŠŸæ ‡å‡†

#### æŠ€æœ¯æŒ‡æ ‡
- [ ] æ•°æ®å®Œæ•´æ€§ 100%
- [ ] API å“åº”æ—¶é—´æ”¹å–„ â‰¥ 30%
- [ ] æœç´¢åŠŸèƒ½æ€§èƒ½æå‡ â‰¥ 50%
- [ ] ç³»ç»Ÿç¨³å®šæ€§ 99.9%+
- [ ] å†…å­˜ä½¿ç”¨å‡å°‘ â‰¥ 20%

#### ä¸šåŠ¡æŒ‡æ ‡
- [ ] ç”¨æˆ·æ»¡æ„åº¦ä¸ä¸‹é™
- [ ] åŠŸèƒ½ä½¿ç”¨ç‡ä¿æŒç¨³å®š
- [ ] åŠ è½½æ—¶é—´æ˜æ˜¾æ”¹å–„
- [ ] æœç´¢å‡†ç¡®æ€§æå‡

### 2. åç»­ä¼˜åŒ–è®¡åˆ’

#### çŸ­æœŸä¼˜åŒ–ï¼ˆè¿ç§»å 1 å‘¨ï¼‰
- [ ] æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†å’Œå¤„ç†
- [ ] ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- [ ] æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

#### ä¸­æœŸæ‰©å±•ï¼ˆè¿ç§»å 1 æœˆï¼‰
- [ ] å®ç°ç”¨æˆ·æ•°æ®å­˜å‚¨
- [ ] æ·»åŠ ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½
- [ ] å®ç°é«˜çº§æœç´¢åŠŸèƒ½
- [ ] æ•°æ®åˆ†æå’ŒæŠ¥è¡¨åŠŸèƒ½

#### é•¿æœŸè§„åˆ’ï¼ˆè¿ç§»å 3 æœˆï¼‰
- [ ] è€ƒè™‘æ•°æ®åº“åˆ†ç‰‡
- [ ] å®ç°è¯»å†™åˆ†ç¦»
- [ ] æ·»åŠ æ•°æ®å¤‡ä»½è‡ªåŠ¨åŒ–
- [ ] å»ºç«‹æ•°æ®æ²»ç†è§„èŒƒ

---

## ğŸ“ è”ç³»äººå’ŒèŒè´£

### æ ¸å¿ƒå›¢é˜Ÿ
- **é¡¹ç›®ç»ç†ï¼š** è´Ÿè´£æ•´ä½“åè°ƒå’Œè¿›åº¦ç®¡ç†
- **æŠ€æœ¯è´Ÿè´£äººï¼š** è´Ÿè´£æŠ€æœ¯å†³ç­–å’Œé—®é¢˜è§£å†³
- **æ•°æ®åº“å·¥ç¨‹å¸ˆï¼š** è´Ÿè´£æ•°æ®åº“è®¾è®¡å’Œä¼˜åŒ–
- **å‰ç«¯å·¥ç¨‹å¸ˆï¼š** è´Ÿè´£ API é›†æˆå’Œæµ‹è¯•
- **è¿ç»´å·¥ç¨‹å¸ˆï¼š** è´Ÿè´£éƒ¨ç½²å’Œç›‘æ§

### ç´§æ€¥è”ç³»
- **æŠ€æœ¯ç´§æ€¥è”ç³»äººï¼š** [ç”µè¯/Slack]
- **è¿ç»´ç´§æ€¥è”ç³»äººï¼š** [ç”µè¯/Slack]
- **é¡¹ç›®ç®¡ç†ç´§æ€¥è”ç³»äººï¼š** [ç”µè¯/Slack]

---

*æ­¤è®¡åˆ’å°†åœ¨é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹ä¸­æ ¹æ®å®é™…æƒ…å†µåŠ¨æ€è°ƒæ•´ï¼Œç¡®ä¿é¡¹ç›®æˆåŠŸäº¤ä»˜ã€‚*